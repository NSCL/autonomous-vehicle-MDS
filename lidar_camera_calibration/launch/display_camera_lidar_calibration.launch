<?xml version="1.0" encoding="UTF-8"?>
<launch>

    <arg name="camera" default="/sensors/camera" />

    <!-- Play rosbag record -->
    <include file="$(find lidar_camera_calibration)/launch/play_rosbag.launch">
        <arg name="bagfile" value="2020-04-03-15-06-49_updated.bag" />
    </include>

    <!-- Nodelet manager for this pipeline -->
    <node
        pkg="nodelet"
        type="nodelet"
        args="manager"
        name="lidar_camera_manager"
        output="screen" />

    <node
        pkg="image_proc"
        type="image_proc" 
        name="image_proc_node1" />

    <!-- Run image_proc/rectify nodelet -->
    <node
        pkg="nodelet"
        type="nodelet"
        name="rectify_color"
        args="load image_proc/rectify lidar_camera_manager --no-bond" >
        
        <!-- Remap input topics -->
        <remap from="image_mono" to="/usb_cam/image_raw" />
        <remap from="camera_info" to="/usb_cam/camera_info" />

        <!-- Remap output topics -->
        <remap from="image_rect" to="$(arg camera)/image_rect_color" />
    </node>

    <!-- Wire static transform from the world to velodyne frame -->
    <node
        pkg="tf2_ros"
        type="static_transform_publisher"
        name="world_velodyne_tf"
        output="screen"
        args="-0.07051517827671029 -0.276121864724775 -0.312139812320133 0.838707117492 -1.52093524518 0.711532606314 world velodyne" />

    <!-- Setup params for Camera-LiDAR calibration script -->
    <param name="camera_info_topic" type="str" value="/usb_cam/camera_info" />
    <param name="image_color_topic" type="str" value="$(arg camera)/image_rect_color" />
    <param name="velodyne_points_topic" type="str" value="/velodyne_points" />
    <param name="camera_lidar_topic" type="str" value="$(arg camera)/camera_lidar" />
    <param name="project_mode" type="bool" value="true" />

    <!-- Run Camera-LiDAR projection script -->
    <node   
        pkg="lidar_camera_calibration"
        type="calibrate_camera_lidar.py"
        name="calibrate_camera_lidar"
        output="screen" />

    <!-- Run image view to display the projected points image -->
    <node 
        name="camera_lidar_projection" 
        pkg="image_view"
        type="image_view"
        respawn="false"
        output="screen">
        
        <!-- Remap input topics -->
        <remap from="image" to="$(arg camera)/camera_lidar" />
    </node>

</launch>

<!--
Euler angles (RPY): 1.38049014629 -1.44983286469 0.177706879506
Rotation Matrix: [[ 0.02282563 -0.99967629 -0.01123852]
 [ 0.11849018  0.01386736 -0.99285839]
 [ 0.99269284  0.02133097  0.11876835]]
Translation Offsets: [[-0.06092575 -0.59067396 -0.18739969]]


Euler angles (RPY): 1.48964488343 -1.52614266191 0.0810944594524
Rotation Matrix: [[ 3.61853050e-03 -9.99993453e-01  2.35542936e-05]
 [ 4.44919217e-02  1.37465307e-04 -9.99009735e-01]
 [ 9.99003191e-01  3.61599517e-03  4.44921278e-02]]
Translation Offsets: [[-0.03593455 -0.30808155 -0.4012141 ]]

args=" -0.03593455 -0.30808155 -0.4012141 1.48964488343 -1.50614266191 0.0810944594524 world velodyne" />

























 -->

